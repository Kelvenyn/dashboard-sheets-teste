
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Sheets</title>
  <style>
    .scrollable-table {
      max-height: 500px;
      overflow-y: auto;
      overflow-x: auto;
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>

  <input type="text" id="linkPlanilha" placeholder="Cole o link da planilha aqui" style="width: 60%;">
  <button id="importarBtn">IMPORTAR DADOS</button>
  <button id="testeConexaoBtn">TESTAR CONEXÃO</button>
  <button id="limparBtn">LIMPAR</button>
  <button id="exportarBtn">EXPORTAR CSV</button>

  <div class="scrollable-table">
    <table id="tabelaDados">
      <thead>
        <tr><th>Nome</th><th>Indicador</th><th>Valor</th><th>Observação</th></tr>
      </thead>
      <tbody id="corpoTabela">
        <!-- Dados serão inseridos aqui -->
      </tbody>
    </table>
  </div>

  <script>
    let apiURL = '';

    document.getElementById("importarBtn").onclick = function () {
      const linkInput = document.getElementById("linkPlanilha");
      apiURL = linkInput.value.trim();
      if (!apiURL) {
        alert("Cole o link da planilha primeiro.");
        return;
      }
      fetch(apiURL)
        .then(response => response.json())
        .then(data => preencherTabela(data))
        .catch(error => {
          console.error("Erro ao importar:", error);
          alert("Erro ao importar os dados.");
        });
    };

    document.getElementById("testeConexaoBtn").onclick = function () {
      if (!apiURL) {
        alert("Cole o link da planilha primeiro.");
        return;
      }
      fetch(apiURL)
        .then(response => {
          if (response.ok) {
            alert("✅ Conexão bem-sucedida!");
          } else {
            alert("❌ Erro na conexão.");
          }
        })
        .catch(() => alert("❌ Erro ao tentar conectar."));
    };

    document.getElementById("limparBtn").onclick = function () {
      const corpo = document.getElementById("corpoTabela");
      corpo.innerHTML = "";
    };

    document.getElementById("exportarBtn").onclick = function () {
      let table = document.getElementById("tabelaDados");
      let csv = [];
      for (let row of table.rows) {
        let cols = Array.from(row.cells).map(cell => `"${cell.innerText}"`);
        csv.push(cols.join(","));
      }
      let blob = new Blob([csv.join("\n")], { type: "text/csv" });
      let a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "dados_exportados.csv";
      a.click();
    };

    function preencherTabela(data) {
      const corpo = document.getElementById("corpoTabela");
      corpo.innerHTML = "";
      data.forEach(row => {
        let tr = document.createElement("tr");
        for (let key in row) {
          let td = document.createElement("td");
          td.textContent = row[key];
          tr.appendChild(td);
        }
        corpo.appendChild(tr);
      });
    }
  </script>

</body>
</html>
